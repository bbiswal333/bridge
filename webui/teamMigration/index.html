<html>
	<head>
		<title>Bridge Migration</title>
		<script src="lib/jQuery-2_1_0/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/bridge.css">
		<link rel="stylesheet" type="text/css" href="css/bridgeColors.css">
		<link rel="stylesheet" type="text/css" href="lib/bootstrap-3_1_1/css/bootstrap.min.css">
		<style>
			.Center-Container {
				position: relative;
			}
			.Absolute-Center {
				width: 800px;
				height: 50%;
				overflow: auto;
				margin: auto;
				position: absolute;
				top: 0; left: 0; bottom: 0; right: 0;
			}
		</style>
		<script type="text/javascript">
			var oldConfig;

			function doRedirect() {
				window.location = window.location.origin.replace("-teams", "");
			}

			$.ajax({
                url: "https://ifp.wdf.sap.corp/sap/bc/bridge/IS_MIGRATED?source_instance=" + window.location.hostname,
                type: "GET",
                success: function(data) {
                	if(data.message === "migrated" || data.message === "no_config") {
                		doRedirect();
                	}
                },
                error: function() {
                }
            });

            $.ajax({
                url: "https://ifp.wdf.sap.corp/sap/bc/bridge/GETUSERCONFIG?instance=" + window.location.hostname,
                type: "GET",
                success: function(data) {
                	oldConfig = data;
                },
                error: function() {
                }
            });

            function migrate(bSkip) {
            	$.ajax({
	                url: "https://ifp.wdf.sap.corp/sap/bc/bridge/MIGRATE_CONFIG?new_timestamp=" + new Date().toISOString() + "&source_instance=" + window.location.hostname + "&target_instance=" + window.location.hostname.replace('-teams', '') + (bSkip ? "&skip_migration=X" : ""),
	                type: "GET",
	                success: function(data) {
	                	doRedirect();
	                },
	                error: function() {
	                	
	                }
	            });
            }

            function dontMigrate() {
            	migrate(true);
            }
		</script>
	</head>
	<body class="basic-blue Center-Container">
		<div class="Absolute-Center">
			<div>
				<img src="img/bridge-logo.svg" width="100" style="margin-bottom: 10px" /><span style="color: #ffffff; font-size: 4.5rem; vertical-align: bottom"> Bridge-Teams is going live!</span>
			</div>
			<div style="color: #ffffff; font-size: 1.8rem; font-style: italic">
				You have the chance to migrate your team config into the productive bridge environment or start from scratch.
				In case you already have a productive bridge config, the productive version will be overwritten.
			</div>
			<div style="text-align: right">
				<button type="button" class="btn btn-default" aria-label="Left Align" onclick="dontMigrate();">
					<span class="glyphicon glyphicon-remove" aria-hidden="true"> <b><u>Don't</u></b> migrate config</span>
				</button>
				<button type="button" class="btn btn-default" aria-label="Left Align" onclick="migrate()">
					<span class="glyphicon glyphicon-ok" aria-hidden="true"> Migrate config</span>
				</button>
			</div>
		</div>
	</body>
</html>