(function(){ovi.provide("nokia.maps.gfx.CanvasPainter");
(function(){if(nokia.maps.dom.supportsCanvas&&!/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=!("naturalWidth"in new Image),l=nokia.maps.gfx,h=Math,d=h.sqrt,c=h.pow,h=l.Painter,g=l.IDL,b=l.Color,f=g.opcodes,r=g.identifierToAttribute,a=nokia.maps.util.d,a=nokia.maps.util.d,q=h.Ag,l=nokia.maps.gfx.CanvasPainter=new ovi.Class({Extends:nokia.maps.gfx.Painter,updateElement:function(a,b,c){this.pa(a,b,b.ownerDocument);c=q(c);b.style.opacity=b.$n$opacity=c;b.$n$width=a.data[1];b.$n$height=a.data[2]},
createElement:function(a,b,c){b=(b||document).createElement("CANVAS");this.pa(a,b);c=q(c);b.style.opacity=b.$n$opacity=c;b.$n$width=a.data[1];b.$n$height=a.data[2];return b},setOpacity:function(a,b){b=q(b);a.style.opacity=a.$n$opacity=b;return this},setScale:function(a,b){a.style.width=a.$n$width*b.x+"px";a.style.height=a.$n$height*b.y+"px"},pa:function(b,c){var k;(!b||!b.data)&&a("CanvasPainter.createElement: Illegal IDL given");var d=b.data,e,g;d[0]!==f.BEGIN_2D_IMAGE&&a("CanvasPainter.createElement: Illegal opcode in IDL");
e=c.width=d[1];k=c.height=d[2],d=k;c.style.width=e+"px";c.style.height=d+"px";g=c.getContext("2d");g.clearRect(0,0,e,d);this.drawIDLToCanvas(b,g)},drawIDLToCanvas:function(g,h){(!g||!g.data)&&a("CanvasPainter.createElement: Illegal IDL given");var p=g.data,q,l,u,w,x,v,y,B,C,A,D=!0,E,O,I;p[0]!==f.BEGIN_2D_IMAGE&&a("CanvasPainter.createElement: Illegal opcode in IDL");q=3;h.save();for(h.lineCap="round";l=p[++q];)l===f.BEGIN_PATH?h.beginPath():l===f.MOVE_TO?h.moveTo(p[++q],p[++q]):l===f.LINE_TO?h.lineTo(p[++q],
p[++q]):l===f.BEZIER_CURVE_TO?h.bezierCurveTo(p[++q],p[++q],p[++q],p[++q],p[++q],p[++q]):l===f.FILL?(h.fill(),p[q+1]===f.STROKE&&(++q,D&&h.stroke())):l===f.STROKE?(D&&h.stroke(),p[q+1]===f.FILL&&(++q,h.fill())):l===f.SET?(l=r[p[++q]],y=p[++q],l==="fillColor"?h.fillStyle=b.getCssRGBA(y):l==="strokeColor"?h.strokeStyle=b.getCssRGBA(y):l==="opacity"?h.globalAlpha=+y:l!=="textBaseline"&&(l==="lineWidth"?D=(h[l]=y)!==0:l&&(h[l]=y))):l===f.DRAW_IMAGE||l===f.DRAW_IDL?(h.save(),y=p[++q],C=p[++q],u=p[++q],
v=p[++q],B=p[++q],x=p[++q],w=p[++q],O=p[++q],I=p[++q],A=p[++q],A=A.rows,h.transform(A[0][0],A[1][0],A[0][1],A[1][1],A[0][3],A[1][3]),l===f.DRAW_IMAGE&&y.nodeName!=="CANVAS"&&e?(E=new Image,E.src=y.src):E=y,A=E.naturalWidth||E.width,E=E.naturalHeight||E.height,A=(C+v>A?A-C:v)/v,E=(u+B>E?E-u:B)/B,l===f.DRAW_IMAGE?h.drawImage(y,C,u,v*A,B*E,x,w,O*A,I*E):(h.beginPath(),h.rect(x,w,O*A,I*E),h.clip(),A=O/v,E=I/B,h.translate(x-C*A,w-u*E),h.scale(A,E),this.drawIDLToCanvas(y,h)),h.restore()):l===f.SAVE?h.save():
l===f.RESTORE?h.restore():(y=l===f.FILL_TEXT,(C=l===f.STROKE_TEXT)||y?(v=p[++q],l=p[++q],u=p[++q],w=p[++q]-l,x=p[++q]-u,B=d(c(w,2)+c(x,2)),w/=B,x/=B,h.save(),h.transform(B*w,B*x,B*-x,B*w,l,u),y&&h.fillText(v,0,0),C&&h.strokeText(v,0,0),h.restore()):l===f.CLOSE_PATH&&h.closePath());h.restore()}});if(!h.defaultPainter)h.defaultPainter=l}})();ovi.provide("nokia.maps.gfx._packaging.package-canvas");})();
