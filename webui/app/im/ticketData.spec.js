describe("Ticket Data Service for InternalMessages", function () {

    var $httpBackend;
    var $q;
    var imTicketData;
    var mockData = '<asx:abap xmlns:asx="http://www.sap.com/abapxml" version="1.0"><asx:values><INTCOMP_SHORT><ESKGRND/><PRIO1>0</PRIO1><PRIO2>0</PRIO2><PRIO3>0</PRIO3><PRIO4>1</PRIO4></INTCOMP_SHORT><INTCOMP_LONG><DEVDB_MESSAGE_OUT><CSINSTA>0120061532</CSINSTA><MNUMM>0001228053</MNUMM><MYEAR>2014</MYEAR><PRIO>4</PRIO><PRIOSTXT>Low</PRIOSTXT><STATUSSTXT>New</STATUSSTXT><KTEXT>Filter in ATC Notification</KTEXT><STATUS/><THEMKEXT>BC-SRV-AGL</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2014-06-23</ERFDATUM><ERFZEIT>12:31:35</ERFZEIT><FIRMA/><ADRNR>0100337839</ADRNR><SUSID>I827833</SUSID><SAPNA>DELLAGUSTIN</SAPNA><VORNA>Guilherme</VORNA><NACHN>Dellagustin</NACHN><TEL01>63975</TEL01><AEDATUM>2014-06-23</AEDATUM><AEZEIT>12:31:35</AEZEIT><SOURCE/><PROJECTID/><MPTDATUM>2015-06-23</MPTDATUM><MPTZEIT>12:31:35</MPTZEIT><IRTDATUM>0000-00-00</IRTDATUM><IRTZEIT>00:00:00</IRTZEIT><CORSYSTEM>HRI</CORSYSTEM><CORRELEASE/><IRTSTATUS/><IRTPERCENT/><KNDID/><INSTID/><AENAME>I827833</AENAME><WORKPRIO>100</WORKPRIO><INFO>WIKI</INFO><NW_RELEASE>740</NW_RELEASE></DEVDB_MESSAGE_OUT></INTCOMP_LONG><INTPERS_SHORT><ESKGRND/><PRIO1>0</PRIO1><PRIO2>0</PRIO2><PRIO3>1</PRIO3><PRIO4>0</PRIO4></INTPERS_SHORT><INTPERS_LONG><DEVDB_MESSAGE_OUT><CSINSTA>0120061532</CSINSTA><MNUMM>0001160562</MNUMM><MYEAR>2014</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>In Process</STATUSSTXT><KTEXT>Messages I unsubscribed are back</KTEXT><STATUS/><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2014-06-04</ERFDATUM><ERFZEIT>07:03:45</ERFZEIT><FIRMA/><ADRNR>0100147161</ADRNR><SUSID>D039588</SUSID><SAPNA>HUSSMANN</SAPNA><VORNA>Wolfram</VORNA><NACHN>Hussmann</NACHN><TEL01>48077</TEL01><AEDATUM>2014-06-17</AEDATUM><AEZEIT>10:47:56</AEZEIT><SOURCE/><PROJECTID/><MPTDATUM>2014-07-02</MPTDATUM><MPTZEIT>07:02:56</MPTZEIT><IRTDATUM>0000-00-00</IRTDATUM><IRTZEIT>00:00:00</IRTZEIT><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><IRTSTATUS/><IRTPERCENT/><KNDID/><INSTID/><AENAME>D039588</AENAME><WORKPRIO>390</WORKPRIO><INFO>WIKI</INFO><NW_RELEASE/></DEVDB_MESSAGE_OUT></INTPERS_LONG><INTCREATED_SHORT><ESKGRND/><PRIO1>0</PRIO1><PRIO2>0</PRIO2><PRIO3>1</PRIO3><PRIO4>0</PRIO4></INTCREATED_SHORT><INTCREATED_LONG><DEVDB_INTMESSAGE_OUT><CSINSTA>0120031469</CSINSTA><MNUMM>0000442440</MNUMM><MYEAR>2014</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Completed</STATUSSTXT><STATUS/><KTEXT>Handlebars Template escapes binding string</KTEXT><THEMKEXT>CA-UI5</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2014-05-06</ERFDATUM><ERFZEIT>12:17:37</ERFZEIT><FIRMA/><ADRNR>0100255599</ADRNR><SUSID>D050479</SUSID><SAPNA>TUIDER</SAPNA><VORNA>Ruben</VORNA><NACHN>Tuider</NACHN><TEL01>48853</TEL01><AEDATUM>2014-06-23</AEDATUM><AEZEIT>13:04:42</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>-</CORSYSTEM><CORRELEASE>1.2</CORRELEASE><MPTDATUM>2014-06-06</MPTDATUM><MPTZEIT>05:59:10</MPTZEIT><AENAME>D050479</AENAME><WORKPRIO>413</WORKPRIO><INFO/><NW_RELEASE/></DEVDB_INTMESSAGE_OUT></INTCREATED_LONG><INTAUTHACTION_SHORT><ESKGRND/><PRIO1>0</PRIO1><PRIO2>0</PRIO2><PRIO3>2</PRIO3><PRIO4>0</PRIO4></INTAUTHACTION_SHORT><INTAUTHACTION_LONG><DEVDB_MESSAGE_OUT><CSINSTA>0120031469</CSINSTA><MNUMM>0000164206</MNUMM><MYEAR>2014</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><KTEXT>Cannot show message in dashboard</KTEXT><STATUS/><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2014-03-24</ERFDATUM><ERFZEIT>20:17:54</ERFZEIT><FIRMA/><ADRNR>0100346268</ADRNR><SUSID>I067547</SUSID><SAPNA>JIAJIN</SAPNA><VORNA>Jingjing</VORNA><NACHN>Jia</NACHN><TEL01>5248</TEL01><AEDATUM>2014-03-25</AEDATUM><AEZEIT>07:24:10</AEZEIT><SOURCE/><PROJECTID/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><IRTDATUM>0000-00-00</IRTDATUM><IRTZEIT>00:00:00</IRTZEIT><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><IRTSTATUS/><IRTPERCENT/><KNDID/><INSTID/><AENAME>D051804</AENAME><WORKPRIO>351</WORKPRIO><INFO>WIKI</INFO><NW_RELEASE/></DEVDB_MESSAGE_OUT><DEVDB_MESSAGE_OUT><CSINSTA>0120031469</CSINSTA><MNUMM>0000254384</MNUMM><MYEAR>2014</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><KTEXT>SAP employee dashboard does not display</KTEXT><STATUS/><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2014-04-04</ERFDATUM><ERFZEIT>19:29:38</ERFZEIT><FIRMA/><ADRNR>0100254091</ADRNR><SUSID>I816301</SUSID><SAPNA>BRAXTONK</SAPNA><VORNA>Kermit</VORNA><NACHN>Braxton</NACHN><TEL01>1435</TEL01><AEDATUM>2014-04-07</AEDATUM><AEZEIT>08:12:56</AEZEIT><SOURCE/><PROJECTID/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><IRTDATUM>0000-00-00</IRTDATUM><IRTZEIT>00:00:00</IRTZEIT><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><IRTSTATUS/><IRTPERCENT/><KNDID/><INSTID/><AENAME>D051804</AENAME><WORKPRIO>355</WORKPRIO><INFO>WIKI</INFO><NW_RELEASE/></DEVDB_MESSAGE_OUT></INTAUTHACTION_LONG><INTCOMPCOLLEAGUES_SHORT><ESKGRND/><PRIO1>0</PRIO1><PRIO2>1</PRIO2><PRIO3>9</PRIO3><PRIO4>1</PRIO4></INTCOMPCOLLEAGUES_SHORT><INTCOMPCOLLEAGUES_LONG><DEVDB_INTMESSAGE_OUT><CSINSTA>0120061532</CSINSTA><MNUMM>0004504355</MNUMM><MYEAR>2012</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>In Process</STATUSSTXT><STATUS/><KTEXT>Navigation to ST22 does not work</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2012-12-14</ERFDATUM><ERFZEIT>14:24:45</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2013-01-28</AEDATUM><AEZEIT>11:57:00</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><MPTDATUM>2013-02-06</MPTDATUM><MPTZEIT>21:43:00</MPTZEIT><AENAME>D000945</AENAME><WORKPRIO>457</WORKPRIO><INFO>COMMUNITY</INFO><NW_RELEASE/></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120031469</CSINSTA><MNUMM>0000530795</MNUMM><MYEAR>2013</MYEAR><PRIO>4</PRIO><PRIOSTXT>Low</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><STATUS/><KTEXT>How to add components for customer messages</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2013-03-20</ERFDATUM><ERFZEIT>17:55:50</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2013-04-05</AEDATUM><AEZEIT>10:35:34</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><AENAME>D049677</AENAME><WORKPRIO>101</WORKPRIO><INFO>COMMUNITY</INFO><NW_RELEASE/></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120031469</CSINSTA><MNUMM>0001765695</MNUMM><MYEAR>2013</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><STATUS/><KTEXT>Cant launch Employee Dashboard</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2013-05-09</ERFDATUM><ERFZEIT>09:46:01</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2013-05-13</AEDATUM><AEZEIT>06:44:50</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><AENAME>D049677</AENAME><WORKPRIO>358</WORKPRIO><INFO>WIKI</INFO><NW_RELEASE/></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120031469</CSINSTA><MNUMM>0001784288</MNUMM><MYEAR>2013</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><STATUS/><KTEXT>SAP Employee Dashboard opens as blank screen</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2013-05-10</ERFDATUM><ERFZEIT>06:25:05</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2013-05-13</AEDATUM><AEZEIT>06:47:28</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><AENAME>D049677</AENAME><WORKPRIO>356</WORKPRIO><INFO>COMMUNITY</INFO><NW_RELEASE/></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120031469</CSINSTA><MNUMM>0001785498</MNUMM><MYEAR>2013</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><STATUS/><KTEXT>Widgets-Groups are emtpy</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2013-05-10</ERFDATUM><ERFZEIT>07:07:00</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2013-05-13</AEDATUM><AEZEIT>06:52:50</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><AENAME>D049677</AENAME><WORKPRIO>356</WORKPRIO><INFO>COMMUNITY</INFO><NW_RELEASE/></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120061532</CSINSTA><MNUMM>0000024899</MNUMM><MYEAR>2013</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><STATUS/><KTEXT>Top issues with status "solved" displayed as "new"</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2013-01-02</ERFDATUM><ERFZEIT>16:43:53</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2013-03-04</AEDATUM><AEZEIT>15:40:26</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><MPTDATUM>2013-01-30</MPTDATUM><MPTZEIT>16:51:29</MPTZEIT><AENAME>D049677</AENAME><WORKPRIO>420</WORKPRIO><INFO>COMMUNITY</INFO><NW_RELEASE/></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120061532</CSINSTA><MNUMM>0001139983</MNUMM><MYEAR>2013</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><STATUS/><KTEXT>Employee Dashoboard installatio</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2013-02-11</ERFDATUM><ERFZEIT>19:21:24</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2013-02-12</AEDATUM><AEZEIT>06:56:51</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><AENAME>D049677</AENAME><WORKPRIO>351</WORKPRIO><INFO>WIKI</INFO><NW_RELEASE/></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120061532</CSINSTA><MNUMM>0001151416</MNUMM><MYEAR>2014</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><STATUS/><KTEXT>Employee dashboard BCP</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2014-06-02</ERFDATUM><ERFZEIT>13:05:47</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2014-06-03</AEDATUM><AEZEIT>05:58:10</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>BCP</CORSYSTEM><CORRELEASE/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><AENAME>D049677</AENAME><WORKPRIO>351</WORKPRIO><INFO/><NW_RELEASE>740</NW_RELEASE></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120061532</CSINSTA><MNUMM>0001187309</MNUMM><MYEAR>2013</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><STATUS/><KTEXT>ABAP SAPGui SLOWDOWN</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2013-02-13</ERFDATUM><ERFZEIT>07:09:29</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2013-02-15</AEDATUM><AEZEIT>11:16:54</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>730</CORSYSTEM><CORRELEASE/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><AENAME>D049677</AENAME><WORKPRIO>353</WORKPRIO><INFO/><NW_RELEASE/></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120061532</CSINSTA><MNUMM>0001992809</MNUMM><MYEAR>2012</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>Author Action</STATUSSTXT><STATUS/><KTEXT> CATS Compliance_Mouse over_Short Text</KTEXT><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2012-06-15</ERFDATUM><ERFZEIT>08:21:51</ERFZEIT><FIRMA/><ADRNR>0100247748</ADRNR><SUSID>D049677</SUSID><SAPNA>JESCHKEC</SAPNA><VORNA>Christian</VORNA><NACHN>Jeschke</NACHN><TEL01>60457</TEL01><AEDATUM>2012-06-18</AEDATUM><AEZEIT>06:34:57</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>XXX</CORSYSTEM><CORRELEASE/><MPTDATUM>0000-00-00</MPTDATUM><MPTZEIT>00:00:00</MPTZEIT><AENAME>D049677</AENAME><WORKPRIO>350</WORKPRIO><INFO>COMMUNITY</INFO><NW_RELEASE/></DEVDB_INTMESSAGE_OUT><DEVDB_INTMESSAGE_OUT><CSINSTA>0120031469</CSINSTA><MNUMM>0004595382</MNUMM><MYEAR>2013</MYEAR><PRIO>2</PRIO><PRIOSTXT>High</PRIOSTXT><STATUSSTXT>In Process</STATUSSTXT><STATUS/><KTEXT>Wrong status of test plan generation from ABAP Unit Runner</KTEXT><THEMKEXT>BC-SRV-AGL</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2013-11-14</ERFDATUM><ERFZEIT>14:37:54</ERFZEIT><FIRMA/><ADRNR>0100257019</ADRNR><SUSID>D050420</SUSID><SAPNA>SPENGLERM</SAPNA><VORNA>Michael</VORNA><NACHN>Spengler</NACHN><TEL01>43844</TEL01><AEDATUM>2013-11-26</AEDATUM><AEZEIT>10:37:53</AEZEIT><SOURCE/><PROJECTID/><CORSYSTEM>F5V</CORSYSTEM><CORRELEASE/><MPTDATUM>2013-11-25</MPTDATUM><MPTZEIT>03:41:53</MPTZEIT><AENAME>D021522</AENAME><WORKPRIO>600</WORKPRIO><INFO/><NW_RELEASE>740</NW_RELEASE></DEVDB_INTMESSAGE_OUT></INTCOMPCOLLEAGUES_LONG><INTSUBSCRIPTIONS_LONG><DEVDB_MESSAGE_OUT><CSINSTA>0120061532</CSINSTA><MNUMM>0001160562</MNUMM><MYEAR>2014</MYEAR><PRIO>3</PRIO><PRIOSTXT>Medium</PRIOSTXT><STATUSSTXT>In Process</STATUSSTXT><KTEXT>Messages I unsubscribed are back</KTEXT><STATUS>2</STATUS><THEMKEXT>XX-INT-DASH</THEMKEXT><ESKGRND/><ESKTEXT/><ERFDATUM>2014-06-04</ERFDATUM><ERFZEIT>09:03:45</ERFZEIT><FIRMA/><ADRNR>0100283205</ADRNR><SUSID>D051804</SUSID><SAPNA>SCHUELERD</SAPNA><VORNA>Daniel</VORNA><NACHN>Schueler</NACHN><TEL01>62054</TEL01><AEDATUM>2014-06-17</AEDATUM><AEZEIT>12:47:56</AEZEIT><SOURCE/><PROJECTID/><MPTDATUM>2014-07-02</MPTDATUM><MPTZEIT>09:02:56</MPTZEIT><IRTDATUM>0000-00-00</IRTDATUM><IRTZEIT>00:00:00</IRTZEIT><CORSYSTEM/><CORRELEASE/><IRTSTATUS/><IRTPERCENT/><KNDID/><INSTID/><AENAME>D039588</AENAME><WORKPRIO>364</WORKPRIO><INFO>WIKI</INFO><NW_RELEASE/></DEVDB_MESSAGE_OUT></INTSUBSCRIPTIONS_LONG><ERRORS/></asx:values></asx:abap>';
    var deferred;
    var loadDataMock = function() {
        return deferred.promise;
    };

    beforeEach(function () {
        module("app.im");

        inject(["$rootScope", "$httpBackend", "$q", "app.im.ticketData", function (rootScope, _$httpBackend, _$q, _imTicketData) {
            $httpBackend = _$httpBackend;
            $q = _$q;
            imTicketData = _imTicketData;

            $httpBackend.whenGET('https://css.wdf.sap.corp:443/sap/bc/devdb/MYINTERNALMESS?sap-language=en&origin=' + location.origin).respond(mockData);
        }]);
    });

    it("should increase the ticket counter according to the backend data", function () { 
        imTicketData.loadTicketData();
        $httpBackend.flush();
        expect(imTicketData.prios[0].total).toBe(0);
        expect(imTicketData.prios[1].total).toBe(1);
        expect(imTicketData.prios[2].total).toBe(11);
        expect(imTicketData.prios[3].total).toBe(2);
    });

    it("should reset the priorities in the data structure", function () {
        imTicketData.loadTicketData();
        $httpBackend.flush();
        expect(imTicketData.prios[3].total).toBe(2);

        imTicketData.resetData();

        expect(imTicketData.prios[0].total).toBe(0);
        expect(imTicketData.prios[1].total).toBe(0);
        expect(imTicketData.prios[2].total).toBe(0);
        expect(imTicketData.prios[3].total).toBe(0);
    });

    it("should set the initialized flag and get the data from the backend", function () {
        deferred = $q.defer();
        var loadDataCalled = false;

        imTicketData.loadTicketData = loadDataMock;

        var initializePromise = imTicketData.initialize();

        initializePromise.then(function success() {
            expect(imTicketData.isInitialized.value).toBe(true);
            expect(loadDataCalled).toBe(true);
        });

        deferred.resolve();
    });

    it("should set the interval for the data refresh", function () {
        deferred = $q.defer();
        imTicketData.loadTicketData = loadDataMock;
        imTicketData.initialize();

        expect(imTicketData.loadTicketDataInterval).not.toBe(null);
    });
});
